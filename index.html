<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Fluxware Among Us Macro</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="theme-color" content="#000000" />
    <meta name="apple-itunes-app" content="app-id=fluxware" />
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAyNCIgaGVpZ2h0PSIxMDI0IiB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxyZWN0IHdpZHRoPSIxMDI0IiBoZWlnaHQ9IjEwMjQiIGZpbGw9ImJsYWNrIi8+PHBhdGggZD0iTTAgMTAyNEg0MTZWMEgweiBNNDE2IDEwMjRINzY4VjBING16IE03NjggMTAyNEgxMDI0VjBIMTc2eiIgZmlsbD0id2hpdGUiLz48L3N2Zz4=" />
    <style>
        /* iOS Dark Theme & Fullscreen */
        * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
        html, body { height:100%; overflow:hidden; background:#000; color:#fff; font-family:-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        body { display:flex; flex-direction:column; align-items:center; justify-content:flex-start; padding:20px; -webkit-user-select:none; user-select:none; }
        @media (prefers-color-scheme: dark) { body { background:#000; color:#fff; } }

        /* Title */
        h1 {
            font-size:32px; font  font-weight:800; letter-spacing:-0.8px; text-align:center; margin:30px 0 6px;
            background:linear-gradient(135deg, #00ff9d, #00b8ff); -webkit-background-clip:text; -webkit-text-fill-color:transparent;
        }
        p.subtitle {
            font-size:15px; color:#aaa; text-align:center; margin-bottom:30px; font-weight:500;
        }

        /* Tabs */
        .tabs {
            display:flex; width:100%; max-width:400px; background:rgba(255,255,255,0.05); border-radius:16px; padding:4px; margin-bottom:20px;
            border:1px solid rgba(255,255,255,0.1);
        }
        .tab {
            flex:1; padding:10px; text-align:center; font-size:14px; font-weight:600; border-radius:12px; transition:all 0.2s;
        }
        .tab.active { background:rgba(0,200,255,0.3); color:#00e0ff; }

        /* Sections */
        .section { display:none; width:100%; max-width:400px; }
        .section.active { display:block; }

        /* Voice Button */
        .voice-btn {
            width:70px; height:70px; background:#00c8ff; border-radius:50%; margin:20px auto;
            display:flex; align-items:center; justify-content:center; font-size:32px; color:#000; font-weight:900;
            box-shadow:0 8px 24px rgba(0,200,255,0.4); transition:all 0.2s;
        }
        .voice-btn:active { transform:scale(0.92); }
        .voice-btn.listening { background:#ff3b30; animation:pulse 1.5s infinite; }
        @keyframes pulse { 0%,100% { transform:scale(1); } 50% { transform:scale(1.15); } }

        /* Siri Shortcuts */
        .siri-section {
            background:rgba(255,255,255,0.05); border-radius:16px; padding:16px; margin:16px 0;
            border:1px solid rgba(255,255,255,0.1);
        }
        .siri-btn {
            background:rgba(0,200,255,0.2); color:#00e0ff; border:none; border-radius:12px; padding:12px 16px;
            font-size:14px; font-weight:600; width:100%; margin:8px 0; text-align:center;
        }
        .siri-btn:active { background:rgba(0,200,255,0.4); }

        /* Auto-Responder */
        .auto-section {
            background:rgba(255,255,255,0.05); border-radius:16px; padding:16px; margin:16px 0;
            border:1px solid rgba(255,255,255,0.1);
        }
        .auto-toggle {
            display:flex; align-items:center; justify-content:space-between; padding:8px 0;
            font-size:14px;
        }
        .switch {
            width:44px; height:24px; background:#444; border-radius:12px; position:relative; cursor:pointer;
            transition:background 0.2s;
        }
        .switch.active { background:#00c8ff; }
        .switch::after { content:''; width:20px; height:20px; background:#fff; border-radius:50%;
            position:absolute; left:2px; top:2px; transition:transform 0.2s; }
        .switch.active::after { transform:translateX(20px); }

        /* Overlay Canvas */
        #overlay {
            position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:9999; opacity:0.6;
            background:transparent; display:none;
        }
        #overlay.active { display:block; }

        /* Control Grid */
        .control-grid {
            display:grid; grid-template-columns:repeat(3,1fr); gap:16px; margin:20px 0;
        }
        .ctrl-btn {
            background:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.2); border-radius:20px;
            color:#fff; font-size:13px; font-weight:600; padding:18px 8px; text-align:center; transition:all 0.2s;
            backdrop-filter:blur(12px); -webkit-backdrop-filter:blur(12px);
        }
        .ctrl-btn:active { transform:scale(0.92); background:rgba(0,200,255,0.4); }

        /* Joystick */
        .joystick {
            width:120px; height:120px; background:rgba(255,255,255,0.1); border:2px solid rgba(255,255,255,0.3);
            border-radius:50%; position:relative; margin:20px auto;
        }
        .stick {
            width:50px; height:50px; background:#00c8ff; border-radius:50%; position:absolute; left:50%; top:50%;
            transform:translate(-50%,-50%); transition:transform 0.05s;
        }

        /* Macro Grid */
        .macro-grid {
            display:grid; grid-template-columns:repeat(3,1fr); gap:14px; margin-bottom:20px;
        }
        .macro-btn {
            background:rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.15); border-radius:16px;
            color:#fff; font-size:14px; font-weight:600; padding:14px 6px; text-align:center; transition:all 0.2s ease;
            backdrop-filter:blur(10px); -webkit-backdrop-filter:blur(10px);
        }
        .macro-btn:active { transform:scale(0.94); background:rgba(0,200,255,0.3); border-color:#00c8ff; }
        .macro-btn.emergency { background:rgba(255,50,50,0.15); border-color:rgba(255,80,80,0.4); }
        .macro-btn.emergency:active { background:rgba(255,50,50,0.4); }

        /* Custom Input */
        .custom-input {
            display:flex; margin-bottom:16px; gap:8px;
        }
        .custom-input input {
            flex:1; background:rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.15); border-radius:12px;
            padding:12px 14px; color:#fff; font-size:15px; outline:none;
        }
        .custom-input input::placeholder { color:#777; }
        .custom-input button {
            background:#00c8ff; color:#000; font-weight:700; border:none; border-radius:12px; padding:0 16px;
            font-size:14px;
        }
        .custom-input button:active { background:#00a0d0; transform:scale(0.96); }

        /* Color Picker */
        .color-picker {
            display:grid; grid-template-columns:repeat(6,1fr); gap:10px; margin:16px 0;
        }
        .color-swatch {
            width:100%; aspect-ratio:1; border-radius:50%; border:2px solid rgba(255,255,255,0.2); cursor:pointer;
            transition:transform 0.2s, border 0.2s;
        }
        .color-swatch:active { transform:scale(0.9); }
        .color-swatch.selected { border:3px solid #00ff9d; transform:scale(1.1); }

        /* Timer */
        .timer-display {
            font-size:36px; font-weight:800; text-align:center; margin:20px 0; color:#00ff9d;
            font-variant-numeric:tabular-nums;
        }
        .timer-controls {
            display:flex; justify-content:center; gap:12px;
        }
        .timer-btn {
            background:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.2); border-radius:50%;
            width:56px; height:56px; display:flex; align-items:center; justify-content:center; font-size:20px;
        }
        .timer-btn:active { background:rgba(0,200,255,0.3); }

        /* Task Tracker */
        .task-list {
            background:rgba(255,255,255,0.05); border-radius:16px; padding:12px; margin:16px 0;
            border:1px solid rgba(255,255,255,0.1);
        }
        .task-item {
            display:flex; align-items:center; padding:10px 0; border-bottom:1px solid rgba(255,255,255,0.05);
            font-size:14px;
        }
        .task-item:last-child { border-bottom:none; }
        .task-checkbox {
            width:20px; height:20px; border:2px solid #555; border-radius:6px; margin-right:12px;
            display:flex; align-items:center; justify-content:center; transition:all 0.2s;
        }
        .task-checkbox.checked { background:#00ff9d; border-color:#00ff9d; }
        .task-checkbox.checked::after { content:'✓'; color:#000; font-weight:900; font-size:12px; }

        /* Status */
        .status {
            position:fixed; bottom:20px; left:0; right:0; text-align:center; font-size:13px; color:#00ff9d; opacity:0; transition:opacity 0.3s;
        }
        .status.show { opacity:1; }

        /* Ripple */
        .ripple {
            position:absolute; border-radius:50%; background:rgba(0,200,255,0.4); transform:scale(0); animation:ripple 0.6s linear; pointer-events:none;
        }
        @keyframes ripple { to { transform:scale(4); opacity:0; } }

        /* Safe Area */
        @supports(padding:max(0px)) {
            body { padding-left:env(safe-area-inset-left); padding-right:env(safe-area-inset-right); padding-bottom:max(20px, env(safe-area-inset-bottom)); }
        }
    </style>
</head>
<body>

    <!-- Title -->
    <h1>Fluxware</h1>
    <p class="subtitle">Siri + Voice + Auto-Reply • iOS Pro</p>

    <!-- Tabs -->
    <div class="tabs">
        <div class="tab active" data-tab="siri">Siri</div>
        <div class="tab" data-tab="voice">Voice</div>
        <div class="tab" data-tab="control">Control</div>
        <div class="tab" data-tab="chat">Chat</div>
        <div class="tab" data-tab="tasks">Tasks</div>
        <div class="tab" data-tab="timer">Timer</div>
    </div>

    <!-- Siri Tab -->
    <div class="section active" id="siri">
        <div class="siri-section">
            <p style="font-size:14px; margin-bottom:12px;">Say to Siri:</p>
            <button class="siri-btn" onclick="addSiriShortcut('report')">“Report body in Medbay”</button>
            <button class="siri-btn" onclick="addSiriShortcut('emergency')">“Emergency meeting!”</button>
            <button class="siri-btn" onclick="addSiriShortcut('kill')">“Kill target”</button>
            <button class="siri-btn" onclick="addSiriShortcut('vent')">“Vent now”</button>
            <button class="siri-btn" onclick="addSiriShortcut('where')">“Where?”</button>
            <button class="siri-btn" onclick="addSiriShortcut('skip')">“Skip vote”</button>
        </div>
        <div class="auto-section">
            <div class="auto-toggle">
                <span>Auto-Responder</span>
                <div class="switch" id="autoToggle"></div>
            </div>
            <p style="font-size:12px; color:#aaa; margin-top:8px;">
                When someone says <strong>"where"</strong> → auto-reply <strong>"Cafeteria"</strong>
            </p>
        </div>
    </div>

    <!-- Voice Tab -->
    <div class="section" id="voice">
        <button class="voice-btn" id="voiceBtn">Hold to Speak</button>
        <p style="text-align:center; font-size:14px; color:#aaa; margin:16px 0;">
            Say: "Report", "Kill", "Emergency", "Where", "Skip", etc.
        </p>
    </div>

    <!-- Overlay -->
    <canvas id="overlay"></canvas>

    <!-- Control Tab -->
    <div class="section" id="control">
        <div class="control-grid">
            <button class="ctrl-btn" data-action="tap" data-x="50" data-y="30">Report</button>
            <button class="ctrl-btn" data-action="tap" data-x="50" data-y="70">Use</button>
            <button class="ctrl-btn" data-action="tap" data-x="20" data-y="85">Kill</button>
            <button class="ctrl-btn" data-action="tap" data-x="80" data-y="85">Vent</button>
            <button class="ctrl-btn" data-action="tap" data-x="50" data-y="50">Tasks</button>
            <button class="ctrl-btn" data-action="tap" data-x="10" data-y="10">Map</button>
            <button class="ctrl-btn" data-action="hold" data-x="50" data-y="85">Hold Use</button>
            <button class="ctrl-btn" data-action="swipe" data-dir="up">Swipe Up</button>
            <button class="ctrl-btn" data-action="swipe" data-dir="down">Swipe Down</button>
        </div>
        <div class="joystick" id="joystick">
            <div class="stick" id="stick"></div>
        </div>
        <button class="macro-btn" style="width:100%; margin-top:20px;" id="toggleOverlay">Toggle Overlay</button>
    </div>

    <!-- Chat Tab -->
    <div class="section" id="chat">
        <div class="custom-input">
            <input type="text" id="customMsg" placeholder="Type custom message..." />
            <button id="sendCustom">Send</button>
        </div>
        <div class="macro-grid">
            <button class="macro-btn" data-msg="Dead body in Medbay!">Report</button>
            <button class="macro-btn" data-msg="Vented into Admin">Vent</button>
            <button class="macro-btn" data-msg="O2 sabotaged!">Sabo O2</button>
            <button class="macro-btn" data-msg="Scanning...">Fake Task</button>
            <button class="macro-btn emergency" data-msg="EMERGENCY MEETING!">Emergency</button>
            <button class="macro-btn" data-msg="Where?">Where?</button>
            <button class="macro-btn" data-msg="Red sus in Electrical">Sus Red</button>
            <button class="macro-btn" data-msg="Skip vote">Skip</button>
            <button class="macro-btn" data-msg="">Clear</button>
        </div>
        <div class="color-picker">
            <div class="color-swatch" data-color="Red" style="background:#c93333;"></div>
            <div class="color-swatch" data-color="Blue" style="background:#2d38c9;"></div>
            <div class="color-swatch" data-color="Green" style="background:#1f8b3f;"></div>
            <div class="color-swatch" data-color="Pink" style="background:#d56fb1;"></div>
            <div class="color-swatch" data-color="Orange" style="background:#f27c2b;"></div>
            <div class="color-swatch" data-color="Yellow" style="background:#f2d02b;"></div>
            <div class="color-swatch" data-color="Black" style="background:#3a3a3a;"></div>
            <div class="color-swatch" data-color="White" style="background:#e6e6e6;"></div>
            <div class="color-swatch" data-color="Purple" style="background:#7c2bc9;"></div>
            <div class="color-swatch" data-color="Brown" style="background:#8b4513;"></div>
            <div class="color-swatch" data-color="Cyan" style="background:#00ffff;"></div>
            <div class="color-swatch" data-color="Lime" style="background:#7fff00;"></div>
        </div>
    </div>

    <!-- Tasks Tab -->
    <div class="section" id="tasks">
        <div class="task-list" id="taskList">
            <div class="task-item"><div class="task-checkbox" data-task="0"></div> Swipe Card</div>
            <div class="task-item"><div class="task-checkbox" data-task="1"></div> Fix Wiring</div>
            <div class="task-item"><div class="task-checkbox" data-task="2"></div> Empty Garbage</div>
            <div class="task-item"><div class="task-checkbox" data-task="3"></div> Prime Shields</div>
            <div class="task-item"><div class="task-checkbox" data-task="4"></div> Upload Data</div>
            <div class="task-item"><div class="task-checkbox" data-task="5"></div> Stabilize Steering</div>
        </div>
        <button class="macro-btn" style="width:100%; margin-top:12px;" id="fakeAll">Fake All Tasks</button>
    </div>

    <!-- Timer Tab -->
    <div class="section" id="timer">
        <div class="timer-display" id="timerDisplay">00:00</div>
        <div class="timer-controls">
            <button class="timer-btn" id="timerStart">Start</button>
            <button class="timer-btn" id="timerPause">Pause</button>
            <button class="timer-btn" id="timerReset">Reset</button>
        </div>
    </div>

    <!-- Status -->
    <div class="status" id="status"></div>

    <script>
        // === CORE: Clipboard ===
        async function copyToClipboard(text) {
            if (navigator.clipboard && window.isSecureContext) {
                await navigator.clipboard.writeText(text);
            } else {
                const el = document.createElement('textarea');
                el.value = text;
                el.style.position = 'fixed'; el.style.opacity = '0';
                document.body.appendChild(el);
                el.select();
                document.execCommand('copy');
                document.body.removeChild(el);
            }
        }

        // === Status ===
        const status = document.getElementById('status');
        function showStatus(msg, time = 1500) {
            status.textContent = msg;
            status.classList.add('show');
            setTimeout(() => status.classList.remove('show'), time);
        }

        // === Ripple ===
        function ripple(e) {
            const btn = e.currentTarget;
            const r = document.createElement('span');
            const rect = btn.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height);
            const x = e.touches ? e.touches[0].clientX - rect.left - size/2 : e.clientX - rect.left - size/2;
            const y = e.touches ? e.touches[0].clientY - rect.top - size/2 : e.clientY - rect.top - size/2;
            r.className = 'ripple';
            r.style.width = r.style.height = size + 'px';
            r.style.left = x + 'px';
            r.style.top = y + 'px';
            btn.appendChild(r);
            setTimeout(() => r.remove(), 600);
        }

        // === Overlay Canvas ===
        const canvas = document.getElementById('overlay');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        let overlayActive = false;

        function drawTap(x, y) {
            const px = (x / 100) * canvas.width;
            const py = (y / 100) * canvas.height;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.beginPath();
            ctx.arc(px, py, 40, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(0, 200, 255, 0.5)';
            ctx.fill();
            ctx.strokeStyle = '#00ff9d';
            ctx.lineWidth = 4;
            ctx.stroke();
            setTimeout(() => ctx.clearRect(0, 0, canvas.width, canvas.height), 600);
        }

        function drawSwipe(dir) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.font = 'bold 48px system-ui';
            ctx.fillStyle = '#00ff9d';
            ctx.textAlign = 'center';
            ctx.fillText(dir === 'up' ? 'Up' : 'Down', canvas.width/2, canvas.height/2);
            setTimeout(() => ctx.clearRect(0, 0, canvas.width, canvas.height), 800);
        }

        // === SIRI SHORTCUTS ===
        function addSiriShortcut(action) {
            if (window.SiriShortcuts) {
                window.SiriShortcuts.donate({
                    phrase: action === 'report' ? 'Report body in Medbay' :
                            action === 'emergency' ? 'Emergency meeting!' :
                            action === 'kill' ? 'Kill target' :
                            action === 'vent' ? 'Vent now' :
                            action === 'where' ? 'Where?' : 'Skip vote',
                    userInfo: { action }
                }).then(() => showStatus('Siri shortcut added!'))
                 .catch(() => showStatus('Siri not available'));
            } else {
                showStatus('Siri Shortcuts not supported');
            }
        }

        // === AUTO-RESPONDER (Simulated) ===
        const autoToggle = document.getElementById('autoToggle');
        let autoEnabled = false;
        autoToggle.addEventListener('click', () => {
            autoEnabled = !autoEnabled;
            autoToggle.classList.toggle('active');
            showStatus(autoEnabled ? 'Auto-reply ON' : 'Auto-reply OFF');
        });

        // Simulate incoming chat (demo)
        setInterval(() => {
            if (autoEnabled && Math.random() > 0.7) {
                const messages = ['where', 'where?', 'where r u', 'location?'];
                const msg = messages[Math.floor(Math.random() * messages.length)];
                if (msg.includes('where')) {
                    setTimeout(() => {
                        copyToClipboard('Cafeteria');
                        showStatus('Auto: Cafeteria');
                    }, 800);
                }
            }
        }, 3000);

        // === VOICE RECOGNITION ===
        const voiceBtn = document.getElementById('voiceBtn');
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = 'en-US';
        recognition.interimResults = false;
        recognition.maxAlternatives = 1;

        let isListening = false;

        voiceBtn.addEventListener('touchstart', e => {
            e.preventDefault();
            if (!isListening) {
                recognition.start();
                voiceBtn.classList.add('listening');
                voiceBtn.textContent = 'Recording';
                showStatus('Listening...');
                isListening = true;
            }
        });

        voiceBtn.addEventListener('touchend', e => {
            e.preventDefault();
            if (isListening) recognition.stop();
        });

        recognition.onresult = event => {
            const command = event.results[0][0].transcript.trim().toLowerCase();
            handleVoiceCommand(command);
        };

        recognition.onend = () => {
            voiceBtn.classList.remove('listening');
            voiceBtn.textContent = 'Hold to Speak';
            isListening = false;
        };

        recognition.onerror = () => {
            showStatus('Voice error');
            voiceBtn.classList.remove('listening');
            voiceBtn.textContent = 'Hold to Speak';
            isListening = false;
        };

        // === Voice Commands ===
        function handleVoiceCommand(cmd) {
            showStatus(`Heard: "${cmd}"`);
            if (cmd.includes('report')) { triggerControl('tap', 50, 30); }
            else if (cmd.includes('use')) { triggerControl('tap', 50, 70); }
            else if (cmd.includes('kill')) { triggerControl('tap', 20, 85); }
            else if (cmd.includes('vent')) { triggerControl('tap', 80, 85); }
            else if (cmd.includes('emergency')) { triggerChat('EMERGENCY MEETING!'); }
            else if (cmd.includes('where')) { triggerChat('Cafeteria'); }
            else if (cmd.includes('sus red') || cmd.includes('red sus')) { triggerChat('Red sus in Electrical'); }
            else if (cmd.includes('skip')) { triggerChat('Skip vote'); }
            else if (cmd.includes('fake task')) { triggerChat('Scanning...'); }
            else if (cmd.includes('timer start')) { document.getElementById('timerStart').click(); }
            else { showStatus('Unknown command'); }
        }

        function triggerControl(action, x, y, dir) {
            if (action === 'tap') drawTap(x, y);
            else if (action === 'swipe') drawSwipe(dir);
            showStatus(`${action} ${dir || `@${x}%,${y}%`}`);
        }

        function triggerChat(msg) {
            const color = document.querySelector('.color-swatch.selected')?.dataset.color || 'White';
            const final = `${color}: ${msg}`;
            copyToClipboard(final);
            showStatus(`Said: ${final.substring(0,25)}...`);
        }

        // === Other Features (Control, Chat, Tasks, Timer) ===
        document.querySelectorAll('.ctrl-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const action = btn.dataset.action;
                const x = parseFloat(btn.dataset.x) || 50;
                const y = parseFloat(btn.dataset.y) || 50;
                const dir = btn.dataset.dir;
                if (action === 'tap' || action === 'hold') drawTap(x, y);
                else if (action === 'swipe') drawSwipe(dir);
                showStatus(`${action} ${dir || `@${x}%,${y}%`}`);
            });
            btn.addEventListener('touchstart', ripple, {passive:true});
        });

        const joy = document.getElementById('joystick');
        const stick = document.getElementById('stick');
        let joyActive = false;
        joy.addEventListener('touchstart', e => { joyActive = true; e.preventDefault(); }, {passive:false});
        joy.addEventListener('touchmove', e => {
            if (!joyActive) return;
            const touch = e.touches[0];
            const rect = joy.getBoundingClientRect();
            const dx = touch.clientX - rect.left - 60;
            const dy = touch.clientY - rect.top - 60;
            const dist = Math.min(Math.hypot(dx, dy), 35);
            const angle = Math.atan2(dy, dx);
            stick.style.transform = `translate(${dist * Math.cos(angle)}px, ${dist * Math.sin(angle)}px)`;
            e.preventDefault();
        }, {passive:false});
        joy.addEventListener('touchend', () => {
            joyActive = false;
            stick.style.transform = 'translate(-50%, -50%)';
        });

        document.getElementById('toggleOverlay').addEventListener('click', () => {
            overlayActive = !overlayActive;
            canvas.classList.toggle('active');
            showStatus(overlayActive ? 'Overlay ON' : 'Overlay OFF');
        });

        let selectedColor = 'White';
        document.querySelectorAll('.color-swatch').forEach(swatch => {
            swatch.addEventListener('click', () => {
                document.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('selected'));
                swatch.classList.add('selected');
                selectedColor = swatch.dataset.color;
                showStatus(`Color: ${selectedColor}`);
            });
            swatch.addEventListener('touchstart', ripple, {passive:true});
        });

        document.querySelectorAll('.macro-btn[data-msg]').forEach(btn => {
            btn.addEventListener('touchstart', ripple, {passive:true});
            btn.addEventListener('click', async () => {
                const msg = btn.dataset.msg;
                const final = msg ? `${selectedColor}: ${msg}` : '';
                await copyToClipboard(final);
                showStatus(final ? `Copied: ${final.substring(0,25)}...` : 'Chat cleared');
            });
        });

        document.getElementById('sendCustom').addEventListener('click', async () => {
            const input = document.getElementById('customMsg');
            const msg = input.value.trim();
            if (msg) {
                const final = `${selectedColor}: ${msg}`;
                await copyToClipboard(final);
                showStatus(`Sent: ${final.substring(0,25)}...`);
                input.value = '';
            }
        });

        document.querySelectorAll('.task-checkbox').forEach(cb => {
            cb.addEventListener('click', () => {
                cb.classList.toggle('checked');
                const checked = document.querySelectorAll('.task-checkbox.checked').length;
                const total = document.querySelectorAll('.task-checkbox').length;
                showStatus(`Tasks: ${checked}/${total}`);
            });
        });

        document.getElementById('fakeAll').addEventListener('click', async () => {
            document.querySelectorAll('.task-checkbox').forEach(cb => cb.classList.add('checked'));
            await copyToClipboard('All tasks completed.');
            showStatus('Faked all tasks!');
        });

        let timerInterval, seconds = 0;
        const display = document.getElementById('timerDisplay');

        function formatTime(s) {
            const m = Math.floor(s / 60).toString().padStart(2, '0');
            const sec = (s % 60).toString().padStart(2, '0');
            return `${m}:${sec}`;
        }

        document.getElementById('timerStart').addEventListener('click', () => {
            if (!timerInterval) {
                timerInterval = setInterval(() => {
                    seconds++;
                    display.textContent = formatTime(seconds);
                }, 1000);
                showStatus('Timer started');
            }
        });

        document.getElementById('timerPause').addEventListener('click', () => {
            clearInterval(timerInterval);
            timerInterval = null;
            showStatus('Timer paused');
        });

        document.getElementById('timerReset').addEventListener('click', () => {
            clearInterval(timerInterval);
            timerInterval = null;
            seconds = 0;
            display.textContent = '00:00';
            showStatus('Timer reset');
        });

        // Tabs
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById(tab.dataset.tab).classList.add('active');
            });
        });

        // iOS
        const isIOS = /iPhone|iPad|iPod/.test(navigator.userAgent);
        if (isIOS && !window.navigator.standalone) {
            setTimeout(() => {
                const banner = document.createElement('div');
                banner.style.cssText = 'position:fixed; bottom:0; left:0; right:0; background:rgba(0,0,0,0.9); padding:16px; text-align:center; font-size:14px; color:#fff; border-top:1px solid rgba(255,255,255,0.1);';
                banner.innerHTML = 'Tap <strong>Share → Add to Home Screen</strong>';
                document.body.appendChild(banner);
            }, 2500);
        }

        document.addEventListener('touchend', e => {
            const now = Date.now();
            if (now - (window.lastTouch || 0) <= 300) e.preventDefault();
            window.lastTouch = now;
        }, {passive:false});

        document.querySelectorAll('button').forEach(b => {
            b.addEventListener('touchstart', ripple, {passive:true});
        });

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
    </script>
</body>
</html>